---
title: 记一次大量调整组件参数的经历
date: 2021-06-11 11:41:31
tags: JavaScript
image: /2021/06/11/JavaScript/记一次大量调整组件参数的经历/head.jpg
excerpt: AST，yyds
---

图片来源：[pixiv:title 作者：author](source url)

## 前言

Gitee pages上挂的这个静态博客，全都是技术文章博客被以政治敏感封禁了。没什么话说，就这样吧。

## 背景

公司的管理后台系统中某几个类型的下拉筛选框全部都需要添加一个选项搜索的功能，虽然这个功能组件库已经提供，但涉及到数十个页面页面中上百个筛选框，修改起来仍是个不小的问题，经过考虑后得出了4种解决方案：

1. 手动修改，缺点最多，工作量极大且容易出错，作为最后选择
1. 正则表达式匹配筛选框代码块，进行替换，最终因为要匹配的情况太多，单靠正则出错的可能较大，放弃
1. 为筛选框组件添加一个代理层进行处理，缺点是会导致组件行为和组件库的文档出现差异，增加接手难度，因此作为备选
1. 使用基于代码分析的代码修改工具，技术上没有缺点，就是之前没有接触过，这也是这篇文章的主题

## 开始

之前闲着没事逛掘金的时候看到了阿里名下一个叫做“[GoGoCode](https://github.com/thx/gogocode)”的AST处理库，正好中文文档对于刚开始接触这种工具的我也比较好理解。

公司项目是使用React+antd UI组件库开发的。

需要将A、B、C、D、E、F(涉及公司业务，这里使用字母代替)这几个类型的筛选框添加选项搜索的功能，要为这几种类型的筛选框添加`showSearch`以及`optionFilterProp`属性，同时还要将一部分代码中现有的`showSearch={false}`去掉。

首先按照[文档中的示例](https://gogocode.io/zh/docs/specification/replace)：

``` js
.replace('<Select $$$1 placeholder="A" $$$2>$$$3</Select>')
```

不出意外地失败了，原因在于`$$$2`会匹配多个



